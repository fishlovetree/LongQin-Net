@{
    Layout = null;
}
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../lq.png">

    <title>LongQin-登录</title>
    <link href="~/Content/themes/blueskin/css/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/css/signin.css" rel="stylesheet">
    <link href="~/Content/layui/css/layui.css" rel="stylesheet" />
    <link href="~/content/css/login.css" rel="stylesheet" type="text/css" />
    <script src="~/Content/themes/blueskin/js/jquery-2.0.3.min.js"></script>
    <script src="~/Content/layui/layui.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script type="text/javascript">
        $(function () {
            $('#txtUserName').focus();

            $("body").keydown(function (event) {
                if (event.keyCode == "13") {//keyCode=13是回车键
                    $("#btnLogin").click();
                }
            });
        })
    </script>
</head>

<body class="yunBg">
    <div class="yunMain">
        <div class="yunTop">
            <a class="yunLogo" href="#"></a>
        </div>
        <div class="yunItmName">
            <img src="/content/images/admin.jpg" width="31" height="32" /><span class="yunItmS">登录</span>
        </div>
        <div class="yunBox">
            <div class="yun_u1">
                <table class="table table-login">
                    <tr>
                        <td class="first-td">用户名：</td>
                        <td><input type="text" id="txtUserName" name="username" class="form-control w300" placeholder="用户名"></td>
                    </tr>
                    <tr><td></td><td></td></tr>
                    <tr>
                        <td class="first-td">密  码：</td>
                        <td><input type="password" id="txtPassword" name="password" class="form-control w300" placeholder="密码"></td>
                    </tr>
                    <tr>
                        <td class="first-td"></td>
                        <td>
                            <label style="font-weight:normal;">
                                <input id="chkRemember" type="checkbox" value="remember-me" checked="checked" style="position:relative;top:2px;" /> 3天内自动登录
                            </label>
                        </td>
                    </tr>
                    <tr><td></td><td></td></tr>
                    <tr>
                        <td></td>
                        <td>
                            <button id="btnLogin" type="button" class="btn btn-success">登录</button>&nbsp;
                            <button id="btnRegister" type="button" class="btn btn-success">注册</button>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="yunFooter">
            龙&琴版权所有 Copyright © 2021-
            <script>document.write(new Date().getFullYear());</script>
            &nbsp;<a style="font-size:14px;color:#fff" href="http://www.beian.miit.gov.cn">备案号：浙ICP备17011216号</a>
        </div>
    </div>

    <div class="layui-register" style="display: none;margin:20px">
        <form class="layui-form" id="registerForm" lay-filter="registerForm">
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color:red">*</span>邮箱</label>
                <div class="layui-input-block">
                    <input type="text" name="email" id="email" value="" lay-verify="required|email|max" lay-reqtext="邮箱是必填项，岂能为空？" lay-max="50" lay-pretext="邮箱" placeholder="请填写您的邮箱" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color:red">*</span>验证码</label>
                <div class="layui-input-block layui-input-group">
                    <div style="float:left">
                        <input type="text" name="code" id="code" value="" lay-verify="required|number|max" lay-reqtext="验证码是必填项，岂能为空？" lay-max="10" lay-pretext="验证码" placeholder="请填写邮箱验证码" autocomplete="off" class="layui-input">
                    </div>
                    <div style="float:right">
                        <button type="button" class="layui-btn" id="sendCodeBtn">获取验证码</button>
                    </div>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color:red">*</span>密码</label>
                <div class="layui-input-block">
                    <input type="password" name="pwd" id="pwd" lay-verify="required|max|min" lay-reqtext="密码是必填项，岂能为空？" lay-max="25" lay-min="8" lay-pretext="密码" placeholder="请填写您的密码" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color:red">*</span>确认密码</label>
                <div class="layui-input-block">
                    <input type="password" name="confirmPwd" id="confirmPwd" lay-verify="required|max|min|issame" lay-reqtext="确认密码是必填项，岂能为空？" lay-max="25" lay-min="8" lay-pretext="确认密码" placeholder="请填写确认密码" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color:red">*</span>姓名</label>
                <div class="layui-input-block">
                    <input type="text" name="nickName" id="nickName" value="" lay-verify="required|max" lay-reqtext="姓名是必填项，岂能为空？" lay-max="25" lay-pretext="姓名" placeholder="请填写您的姓名" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color:red">*</span>公司</label>
                <div class="layui-input-block">
                    <input type="text" name="company" id="company" value="" lay-verify="required|max" lay-reqtext="公司名称是必填项，岂能为空？" lay-max="25" lay-pretext="公司名称" placeholder="请填写您的公司名称" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">手机</label>
                <div class="layui-input-block">
                    <input type="text" name="phone" id="phone" value="" lay-verify="phone" placeholder="请填写您的手机号" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button type="submit" class="layui-btn" lay-submit="" lay-filter="submitBtn">立即提交</button>
                </div>
            </div>
        </form>
    </div>

    <script>
        var InterValObj; //timer变量，控制时间
        var count = 60; //间隔函数，1秒执行

        //timer处理函数
        function SetRemainTime() {
            if (curCount == 0) {
                $('#sendCodeBtn').removeClass('layui-btn-disabled');
                $('#sendCodeBtn').text("重获验证码");
                window.clearInterval(InterValObj); // 停止计时器
                document.getElementById("sendCodeBtn").removeAttribute("disabled"); //移除禁用状态改为可用
            } else {
                curCount--;
                $('#sendCodeBtn').text(curCount + "秒后重获");
            }
        }

        layui.use(['form'], function () {
            var form = layui.form
                , layer = layui.layer;
            var layerindex = 0;

            $("#btnLogin").click(function () {
                var username = $("#txtUserName").val();
                var password = $("#txtPassword").val();
                var auto = $("#chkRemember").is(":checked");
                if (username.trim() == "") {
                    layer.msg("请输入用户名");
                    return false;
                }
                if (password.trim() == "") {
                    layer.msg("请输入密码");
                    return false;
                }

                $.ajax({
                    type: "post",
                    url: "@Url.Action("login", "account", new { area = "" })",
                    data: { "username": username,"password":password,"autoLogin":auto },
                    success: function (slt) {
                        if (slt && slt.success) {
                            location.href = "/home/index";
                        }
                        else {
                            layer.msg(slt.message || "登录失败，请重试");
                        }
                    }
                });
            });

            $("#btnRegister").click(function () {
                layerindex = layer.open({
                    type: 1,
                    title: '注册'
                    , content: $('.layui-register')
                    , area: ['460px', '540px']
                    , shade: false
                    , resize: false
                    , maxmin: false
                    , success: function (layero, index) {
                        form.render();
                    }
                });
            });

            //自定义验证规则
            form.verify({
                max: function (value, item) {
                    var maxLen = item.getAttribute('lay-max');
                    var pretext = item.getAttribute('lay-pretext');
                    if (value.length > maxLen) {
                        return pretext + '不能大于' + maxLen + '个字符的长度';
                    }
                },
                min: function (value, item) {
                    var minLen = item.getAttribute('lay-min');
                    var pretext = item.getAttribute('lay-pretext');
                    if (value.length < minLen) {
                        return pretext + '至少' + minLen + '位';
                    }
                },
                issame: function (value, item) {
                    var pwd = $("#pwd").val();
                    if (pwd != value) {
                        return '两次输入密码不一致';
                    }
                },
            });

            //监听提交
            form.on('submit(submitBtn)', function (data) {
                var email = $("#email").val();
                var code = $("#code").val();
                var pwd = $("#pwd").val();
                var nickName = $("#nickName").val();
                var company = $("#company").val();
                var phone = $("#phone").val();
                $.ajax({
                    url: "@Url.Action("Register", "Account", new { area = "" })",    //后台数据请求地址
                    type: "post",
                    data: { email: email, code: code, pwd: pwd, nickName: nickName, company: company, phone: phone },
                    async:false,
                    success: function (slt) {
                        if (slt && slt.success) {
                            layer.msg('注册成功');
                            layer.close(layerindex);
                        }
                        else {
                            layer.msg(slt.message || '操作失败，请重试');
                        }
                    }
                });
                return false;
            });

            $('#sendCodeBtn').on('click', function () {
                curCount = count;
                var isValid = form.validate('#email');  // 主动触发验证
                // 验证通过
                if (isValid) {
                    curCount = count;
                    document.getElementById("sendCodeBtn").setAttribute("disabled", "true"); //设置按钮为禁用状态
                    $('#sendCodeBtn').addClass('layui-btn-disabled');
                    $('#sendCodeBtn').text(curCount + "秒后重获");
                    InterValObj = window.setInterval(SetRemainTime, 1000); // 启动计时器timer处理函数，1秒执行一次
                    $.ajax({
                        url: "/Account/SendCode",    //后台数据请求地址
                        type: "post",
                        data: { email: $('#email').val() },
                        async: false,
                        success: function (slt) {
                            if (slt && slt.success) {

                            }
                        }
                    });
                }
            })
        })
    </script>

</body>

</html>
